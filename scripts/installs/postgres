#!/bin/bash
set -euo pipefail

# Install PostgreSQL from the PGDG repo.
# Usage: /usr/local/installs/postgres [version]
# Default version: 17

version="${1:-17}"

export DEBIAN_FRONTEND=noninteractive

add-apt-repo pgdg \
    https://www.postgresql.org/media/keys/ACCC4CF8.asc \
    https://apt.postgresql.org/pub/repos/apt/ noble-pgdg main

apt-get update
apt-get install -y --no-install-recommends "postgresql-${version}"
apt-get clean
rm -rf /var/lib/apt/lists/*

for bin in "/usr/lib/postgresql/${version}/bin"/*; do
    ln -sf "$bin" "/usr/local/bin/$(basename "$bin")"
done
