#!/bin/bash
set -euo pipefail

# Install Node.js from the NodeSource repo.
# Usage: /usr/local/installs/node [major-version]
# Default version: 24

version="${1:-24}"

export DEBIAN_FRONTEND=noninteractive

add-apt-repo nodesource \
    https://deb.nodesource.com/gpgkey/nodesource-repo.gpg.key \
    "https://deb.nodesource.com/node_${version}.x" nodistro main

apt-get update
apt-get install -y --no-install-recommends nodejs
apt-get clean
rm -rf /var/lib/apt/lists/*

# Enable corepack so yarn and pnpm are on PATH
corepack enable

# Set up npm global installs to the persistent home volume
cat > /etc/profile.d/deps-node.sh <<'EOF'
export npm_config_prefix=/home/app/.deps/node
export PATH="/home/app/.deps/node/bin:$PATH"
EOF
